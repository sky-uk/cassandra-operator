apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: grafana
  name: grafana
  namespace: $TARGET_NAMESPACE
spec:
  replicas: 1
  selector:
    matchLabels:
      app: grafana
      deployment: grafana
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: grafana
        deployment: grafana
    spec:
      containers:
        - env:
          - name: GF_AUTH_ANONYMOUS_ENABLED
            value: "true"
          - name: GF_AUTH_ANONYMOUS_ORG_ROLE
            value: "Admin"
          image: grafana/grafana:5.4.3
          imagePullPolicy: IfNotPresent
          name: grafana
          ports:
          - containerPort: 3000
            protocol: TCP
          resources:
            limits:
              cpu: 500m
              memory: 2500Mi
            requests:
              cpu: 100m
              memory: 100Mi
          volumeMounts:
            - mountPath: /var/lib/grafana
              name: grafana-storage
            - mountPath: /etc/grafana/provisioning/datasources/datasource.yml
              name: grafana-config
              subPath: datasource.yml
            - mountPath: /etc/grafana/provisioning/dashboards/dasboards.yml
              name: grafana-config
              subPath: dasboards.yml
            - mountPath: /etc/grafana/provisioning/dashboards/files/Cassandra-Health.json
              name: grafana-config
              subPath: Cassandra-Health.json
            - mountPath: /etc/grafana/provisioning/dashboards/files/Cassandra-Keyspace-Stats.json
              name: grafana-config
              subPath: Cassandra-Keyspace-Stats.json
            - mountPath: /etc/grafana/provisioning/dashboards/files/Cassandra-Memory-And-GC.json
              name: grafana-config
              subPath: Cassandra-Memory-And-GC.json
      volumes:
        - name: grafana-storage
          emptyDir: {}
        - name: grafana-config
          configMap:
            name: grafana-config
            items:
            - key: datasource.yml
              path: datasource.yml
            - key: dasboards.yml
              path: dasboards.yml
            - key: Cassandra-Health.json
              path: Cassandra-Health.json
            - key: Cassandra-Keyspace-Stats.json
              path: Cassandra-Keyspace-Stats.json
            - key: Cassandra-Memory-And-GC.json
              path: Cassandra-Memory-And-GC.json
---
kind: Service
apiVersion: v1
metadata:
  name: grafana
  namespace: $TARGET_NAMESPACE
spec:
  ports:
    - name: http
      port: 3000
      protocol: TCP
      targetPort: 3000
  selector:
    app: grafana
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: grafana-config
  namespace: $TARGET_NAMESPACE
data:
  datasource.yml: |
    apiVersion: 1

    datasources:
     - name: Prometheus
       type: prometheus
       access: proxy
       url: $PROMETHEUS_INTERNAL_URL
       version: 1
       editable: true
  dasboards.yml: |
    apiVersion: 1

    providers:
     - name: 'Cassandra health'
       type: file
       editable: true
       options:
         path: /etc/grafana/provisioning/dashboards/files/Cassandra-Health.json
     - name: 'Cassandra keyspace stats'
       type: file
       editable: true
       options:
         path: /etc/grafana/provisioning/dashboards/files/Cassandra-Keyspace-Stats.json
     - name: 'Cassandra memory'
       type: file
       editable: true
       options:
         path: /etc/grafana/provisioning/dashboards/files/Cassandra-Memory-And-GC.json

  Cassandra-Health.json: |
    { "annotations": { "list": [ { "builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "editable": true, "gnetId": null, "graphTooltip": 0, "id": 841, "iteration": 1562772383962, "links": [], "panels": [ { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }, "id": 62, "panels": [], "repeat": null, "title": "Disk usage", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 8, "w": 12, "x": 0, "y": 1 }, "id": 20, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "kubelet_volume_stats_available_bytes{namespace=\"$namespace\", persistentvolumeclaim=~\".+$cluster.+\"}", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{persistentvolumeclaim}}", "refId": "A", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Free disk", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "bytes", "label": "", "logBase": 1, "max": null, "min": "0", "show": true }, { "format": "bytes", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "fill": 0, "gridPos": { "h": 8, "w": 12, "x": 12, "y": 1 }, "id": 61, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "up{cassandra_cluster=\"$cluster\", pod=~\"$pod\"}", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{pod}}", "refId": "A", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Cassandra up/down", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "decimals": 0, "format": "short", "label": "", "logBase": 1, "max": "1", "min": "0", "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 9 }, "id": 63, "panels": [], "repeat": null, "title": "System Resources", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 0, "y": 10 }, "id": 18, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "process_resident_memory_bytes{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{pod}}", "refId": "A", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Cassandra process RSS", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "bytes", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "bytes", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 12, "y": 10 }, "id": 22, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "(sum by (pod_name)(container_cpu_usage_seconds_total{namespace=~\"$namespace\",container_name=\"cassandra\",pod_name=~\"$pod\"} - container_cpu_usage_seconds_total{namespace=~\"$namespace\",container_name=\"cassandra\",pod_name=~\"$pod\"} offset 30s)) / 30", "format": "time_series", "hide": false, "interval": "30s", "intervalFactor": 1, "legendFormat": "{{ pod_name }} CPU Total", "metric": "", "refId": "A", "step": 30 }, { "expr": "(sum by (pod_name)(container_cpu_user_seconds_total{namespace=~\"$namespace\",container_name=\"cassandra\",pod_name=~\"$pod\"} - container_cpu_user_seconds_total{namespace=~\"$namespace\",container_name=\"cassandra\",pod_name=~\"$pod\"} offset 30s)) / 30", "format": "time_series", "hide": false, "interval": "30s", "intervalFactor": 1, "legendFormat": "{{ pod_name }} CPU User", "refId": "B", "step": 30 }, { "expr": "(sum by (pod_name)(container_cpu_system_seconds_total{namespace=~\"$namespace\",container_name=\"cassandra\",pod_name=~\"$pod\"} - container_cpu_system_seconds_total{namespace=~\"$namespace\",container_name=\"cassandra\",pod_name=~\"$pod\"} offset 30s)) / 30", "format": "time_series", "hide": false, "interval": "30s", "intervalFactor": 1, "legendFormat": "{{ pod_name }} CPU System", "refId": "C", "step": 30 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Container CPU Utilization", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "percentunit", "label": "% of a core", "logBase": 1, "max": null, "min": 0, "show": true }, { "format": "short", "logBase": 1, "max": 100, "min": 0, "show": false } ], "yaxis": { "align": false, "alignLevel": null } }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 17 }, "id": 64, "panels": [], "repeat": null, "title": "Read/Write throughput", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 0, "y": 18 }, "id": 1, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [ { "dashUri": "db/cassandra-read-write-throughput-latency", "dashboard": "Cassandra Read/Write Throughput / Latency", "includeVars": true, "keepTime": true, "targetBlank": true, "title": "Detailed Read/Write Throughput / Latency", "type": "dashboard" } ], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "rate(cassandra_clientrequest_write_latency_count{namespace=\"$namespace\", cassandra_cluster=\"$cluster\", pod=~\"$pod\"}[1m])", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{pod}}", "metric": "", "refId": "A", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Write count per coordinator [rate-1m]", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "label": "requests / second", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "label": "", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 12, "y": 18 }, "id": 6, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [ { "dashUri": "db/cassandra-read-write-throughput-latency", "dashboard": "Cassandra Read/Write Throughput / Latency", "includeVars": true, "keepTime": true, "targetBlank": true, "title": "Detailed Read/Write Throughput / Latency", "type": "dashboard" } ], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "rate(cassandra_clientrequest_read_latency_count{namespace=\"$namespace\", cassandra_cluster=\"$cluster\", pod=~\"$pod\"}[1m])", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{pod}}", "metric": "", "refId": "B", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Read count per coordinator [rate-1m]", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "label": "requests / second", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 25 }, "id": 65, "panels": [], "repeat": null, "title": "Read/Write Latency", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 0, "y": 26 }, "id": 60, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [ { "dashUri": "db/cassandra-read-write-throughput-latency", "dashboard": "Cassandra Read/Write Throughput / Latency", "includeVars": true, "keepTime": true, "targetBlank": true, "title": "Detailed Read/Write Throughput / Latency", "type": "dashboard" } ], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "cassandra_clientrequest_write_latency_99thpercentile{namespace=\"$namespace\", cassandra_cluster=\"$cluster\", pod=~\"$pod\"}", "format": "time_series", "hide": false, "interval": "30s", "intervalFactor": 1, "legendFormat": "{{pod}} 99th", "metric": "", "refId": "C", "step": 120 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Write latency coordinator + replicas  - 99th", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "µs", "label": "time per request", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "µs", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 12, "y": 26 }, "id": 59, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [ { "dashUri": "db/cassandra-read-write-throughput-latency", "dashboard": "Cassandra Read/Write Throughput / Latency", "includeVars": true, "keepTime": true, "targetBlank": true, "title": "Detailed Read/Write Throughput / Latency", "type": "dashboard" } ], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "sum by(pod) (cassandra_clientrequest_read_latency_99thpercentile{namespace=\"$namespace\", cassandra_cluster=\"$cluster\", pod=~\"$pod\"})", "format": "time_series", "hide": false, "interval": "30s", "intervalFactor": 1, "legendFormat": "{{pod}} 99th", "metric": "", "refId": "C", "step": 120 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Read latency coordinator + replicas - 99th", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "µs", "label": "time per request", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "µs", "label": "", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 33 }, "id": 66, "panels": [], "repeat": null, "title": "JVM", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "decimals": null, "editable": true, "error": false, "fill": 3, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 0, "y": 34 }, "hideTimeOverride": false, "id": 12, "legend": { "alignAsTable": false, "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "minSpan": null, "nullPointMode": "connected", "percentage": false, "pointradius": 1, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Gen.*\", namespace=\"$namespace\", pod=~\"$pod\"}", "format": "time_series", "hide": true, "intervalFactor": 2, "legendFormat": "{{pod}} {{ pool }}", "refId": "C", "step": 4 }, { "expr": "jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Eden.*\", namespace=\"$namespace\", pod=~\"$pod\"} + on(pod) jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\",  pool=~\".*Survivor.*\", namespace=\"$namespace\", pod=~\"$pod\"}", "format": "time_series", "hide": true, "intervalFactor": 2, "legendFormat": "{{pod}} young gen", "refId": "D", "step": 4 }, { "expr": "jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Eden.*\", namespace=\"$namespace\", pod=~\"$pod\"} + on(pod) jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Survivor.*\", namespace=\"$namespace\", pod=~\"$pod\"} + on(pod) jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Gen.*\", namespace=\"$namespace\", pod=~\"$pod\"}", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{pod}} ", "refId": "A", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "JVM heap used", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "bytes", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "bytes", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "decimals": null, "editable": true, "error": false, "fill": 3, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 12, "y": 34 }, "hideTimeOverride": false, "id": 54, "legend": { "alignAsTable": false, "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "minSpan": null, "nullPointMode": "connected", "percentage": false, "pointradius": 1, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Code Cache.*\", namespace=\"$namespace\", pod=~\"$pod\"}", "format": "time_series", "hide": true, "intervalFactor": 2, "legendFormat": "{{pod}} code", "refId": "C", "step": 4 }, { "expr": "jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Metaspace.*\", namespace=\"$namespace\", pod=~\"$pod\"}", "format": "time_series", "hide": true, "intervalFactor": 2, "legendFormat": "{{pod}} metaspace", "refId": "D", "step": 4 }, { "expr": "jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Compressed Class.*\", namespace=\"$namespace\", pod=~\"$pod\"}", "format": "time_series", "hide": true, "intervalFactor": 2, "legendFormat": "{{pod}} compressed class", "refId": "B", "step": 4 }, { "expr": "jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Code.*\", namespace=\"$namespace\", pod=~\"$pod\"} + on(pod) jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Meta.*\", namespace=\"$namespace\", pod=~\"$pod\"} + on(pod) jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", pool=~\".*Compress.*\", namespace=\"$namespace\", pod=~\"$pod\"}", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{pod}}", "refId": "A", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "JVM non-heap used", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "bytes", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "bytes", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 41 }, "id": 67, "panels": [], "repeat": null, "title": "Exceptions", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 8, "x": 0, "y": 42 }, "id": 38, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "increase(cassandra_tps_totalblockedtasks_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m])", "format": "time_series", "interval": "30s", "intervalFactor": 1, "legendFormat": "{{pod}} {{pool_name}}", "refId": "B", "step": 120 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Blocked tasks count [increase-1m]", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": true, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 8, "x": 8, "y": 42 }, "id": 9, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": false, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "sum by (pod, pool_name) (cassandra_tps_pendingtasks{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"})", "format": "time_series", "interval": "30s", "intervalFactor": 1, "legendFormat": "{{pod}} {{pool_name}}", "refId": "A", "step": 120 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Pending tasks count", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 8, "x": 16, "y": 42 }, "id": 39, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "increase(cassandra_clientrequest_read_unavailables_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m]) + increase(cassandra_clientrequest_write_unavailables_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m])", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{pod}} reads", "refId": "A", "step": 240 }, { "expr": "increase(cassandra_clientrequest_write_unavailables_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m]) + increase(cassandra_clientrequest_write_unavailables_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m])", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{pod}} writes", "refId": "B", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Unavailable read/write requests count [increase-1m]", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 8, "x": 0, "y": 49 }, "id": 40, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "increase(cassandra_clientrequest_read_timeouts_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m]) + increase(cassandra_clientrequest_write_timeouts_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m])", "format": "time_series", "interval": "", "intervalFactor": 2, "legendFormat": "{{pod}} reads", "refId": "A", "step": 240 }, { "expr": "increase(cassandra_clientrequest_write_timeouts_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m]) + increase(cassandra_clientrequest_write_timeouts_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m])", "format": "time_series", "interval": "", "intervalFactor": 2, "legendFormat": "{{pod}} writes", "refId": "B", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Timeout read/write requests count [increase-1m]", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": true, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 8, "x": 8, "y": 49 }, "id": 57, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": false, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "increase(cassandra_connection_timeouts_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m])", "format": "time_series", "interval": "", "intervalFactor": 2, "legendFormat": "{{pod}} -> {{address}}", "refId": "A", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Node-to-Node connection timeout [increase-1m]", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 8, "x": 16, "y": 49 }, "id": 2, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "sum(cassandra_droppedmessage_dropped_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}) by (pod, message_type) ", "format": "time_series", "hide": true, "intervalFactor": 2, "legendFormat": "{{pod}} {{message_type}}", "refId": "A", "step": 2 }, { "expr": "sum(increase(cassandra_droppedmessage_dropped_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[1m])) by (pod, message_type) ", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{pod}} {{message_type}}", "refId": "B", "step": 240 } ], "thresholds": [], "timeFrom": null, "timeShift": null, "title": "Dropped messages count", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } } ], "refresh": false, "schemaVersion": 16, "style": "dark", "tags": [], "templating": { "list": [ { "current": { "text": "Core Prometheus Dev", "value": "Core Prometheus Dev" }, "hide": 0, "label": null, "name": "prometheus", "options": [], "query": "prometheus", "refresh": 1, "regex": ".*", "skipUrlSync": false, "type": "datasource" }, { "allValue": null, "current": { "isNone": true, "text": "None", "value": "" }, "datasource": "$prometheus", "hide": 0, "includeAll": false, "label": null, "multi": false, "name": "namespace", "options": [], "query": "label_values(jvm_gc_collection_seconds_sum{cassandra_cluster=~\".+\"}, namespace)", "refresh": 1, "regex": "", "skipUrlSync": false, "sort": 1, "tagValuesQuery": "", "tags": [], "tagsQuery": "", "type": "query", "useTags": false }, { "allFormat": "regex wildcard", "allValue": ".*", "current": { "isNone": true, "text": "None", "value": "" }, "datasource": "$prometheus", "hide": 0, "hideLabel": false, "includeAll": false, "label": null, "multi": false, "multiFormat": "regex values", "name": "cluster", "options": [], "query": "label_values(jvm_gc_collection_seconds_sum{namespace=\"$namespace\"}, cassandra_cluster)", "refresh": 1, "refresh_on_load": false, "regex": "", "skipUrlSync": false, "sort": 0, "tagValuesQuery": null, "tags": [], "tagsQuery": null, "type": "query", "useTags": false }, { "allValue": "", "current": { "text": "All", "value": [ "$__all" ] }, "datasource": "$prometheus", "hide": 0, "includeAll": true, "label": null, "multi": true, "name": "pod", "options": [], "query": "label_values(jvm_memory_pool_bytes_used{cassandra_cluster=\"$cluster\", namespace=\"$namespace\"},pod)", "refresh": 1, "regex": "${cluster}-.+", "skipUrlSync": false, "sort": 1, "tagValuesQuery": "", "tags": [], "tagsQuery": "", "type": "query", "useTags": false } ] }, "time": { "from": "now-3h", "to": "now" }, "timepicker": { "now": true, "refresh_intervals": [ "5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d" ], "time_options": [ "5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d" ] }, "timezone": "browser", "title": "Cassandra Health - Operator Clusters", "uid": "KCFSTzxiz", "version": 13 }
  Cassandra-Keyspace-Stats.json: |
    { "annotations": { "list": [ { "builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "editable": true, "gnetId": null, "graphTooltip": 0, "iteration": 1562773873191, "links": [], "panels": [ { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }, "id": 18, "panels": [], "repeat": null, "title": "Disk Load", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 1 }, "id": 5, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "avg(cassandra_table_livediskspaceused{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", keyspace=~\"$keyspace\", table=~\"$table\", pod=~\"$pod\"}) by (keyspace, table)", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{table}}", "refId": "A", "step": 30 }, { "expr": "sum(avg(cassandra_table_livediskspaceused{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}) by (keyspace, table)) by (keyspace)", "format": "time_series", "hide": true, "intervalFactor": 2, "legendFormat": "{{keyspace}}", "refId": "B", "step": 4 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Average table disk load", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "bytes", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 8 }, "id": 19, "panels": [], "repeat": null, "title": "Tombstones", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "fill": 1, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 9 }, "id": 6, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "cassandra_table_tombstonescannedhistogram_999thpercentile{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", keyspace=~\"$keyspace\", table=~\"$table\", pod=~\"$pod\"}", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{pod}} {{keyspace}} {{table}}", "refId": "A", "step": 30 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "999th tombstones scanned", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 16 }, "id": 20, "panels": [], "repeat": null, "title": "Dashboard Row", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "fill": 1, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 17 }, "id": 7, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "max(cassandra_table_maxpartitionsize{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", keyspace=~\"$keyspace\", table=~\"$table\", pod=~\"$pod\"}) by (keyspace, table)", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{keyspace}} {{table}}", "refId": "A", "step": 30 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Max row size", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "decbytes", "label": null, "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 24 }, "id": 21, "panels": [], "repeat": null, "title": "Table Read/Write", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 0, "y": 25 }, "id": 1, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "sum(rate(cassandra_table_writelatency_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", keyspace=~\"$keyspace\", table=~\"$table\", pod=~\"$pod\"}[1m])) by (keyspace, table)", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{keyspace}} {{table}}", "refId": "A", "step": 60 }, { "expr": "", "format": "time_series", "intervalFactor": 2, "legendFormat": "", "refId": "B" } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Table write count local to node [rate-1m]", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 12, "y": 25 }, "id": 2, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "sum(rate(cassandra_table_readlatency_count{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", keyspace=~\"$keyspace\", table=~\"$table\", pod=~\"$pod\"}[1m])) by (keyspace, table)", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{keyspace}} {{table}}", "refId": "A", "step": 60 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Table read count local to node [rate-1m]", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "collapsed": false, "gridPos": { "h": 1, "w": 24, "x": 0, "y": 32 }, "id": 22, "panels": [], "repeat": "pod", "title": "Table Read/Write $pod", "type": "row" }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 0, "y": 33 }, "id": 3, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "cassandra_table_writelatency_50thpercentile{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", keyspace=~\"$keyspace\", table=~\"$table\", pod=\"$pod\"}", "format": "time_series", "hide": true, "intervalFactor": 2, "legendFormat": "{{pod}} {{table}} 50th", "refId": "A", "step": 60 }, { "expr": "cassandra_table_writelatency_999thpercentile{cassandra_cluster=\"$cluster\", keyspace=~\"$keyspace\", table=~\"$table\", pod=\"$pod\"}", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{pod}} {{keyspace}} {{table}} 999th", "refId": "B", "step": 60 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Table write latency local to node", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "µs", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 7, "w": 12, "x": 12, "y": 33 }, "id": 4, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "cassandra_table_readlatency_50thpercentile{cassandra_cluster=\"$cluster\", keyspace=~\"$keyspace\", table=~\"$table\", pod=\"$pod\"}", "format": "time_series", "hide": true, "intervalFactor": 2, "legendFormat": "{{pod}} {{table}} 50th", "refId": "A", "step": 10 }, { "expr": "cassandra_table_writelatency_999thpercentile{cassandra_cluster=\"$cluster\", keyspace=~\"$keyspace\", table=~\"$table\", pod=\"$pod\"}", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{pod}} {{keyspace}} {{table}} 999th", "refId": "B", "step": 60 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Table read latency local to node", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "µs", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } } ], "refresh": false, "schemaVersion": 16, "style": "dark", "tags": [], "templating": { "list": [ { "current": { "tags": [], "text": "Prometheus", "value": "Prometheus" }, "hide": 0, "label": null, "name": "prometheus", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "skipUrlSync": false, "type": "datasource" }, { "allValue": null, "current": { "tags": [], "text": "test-cassandra-operator", "value": "test-cassandra-operator" }, "datasource": "$prometheus", "definition": "", "hide": 0, "includeAll": false, "label": null, "multi": false, "name": "namespace", "options": [], "query": "label_values(jvm_memory_pool_bytes_used{cassandra_cluster=~\".+\"},namespace)", "refresh": 1, "regex": "", "skipUrlSync": false, "sort": 1, "tagValuesQuery": "", "tags": [], "tagsQuery": "", "type": "query", "useTags": false }, { "allFormat": "glob", "allValue": null, "current": { "tags": [], "text": "small-cluster", "value": "small-cluster" }, "datasource": "$prometheus", "definition": "", "hide": 0, "includeAll": false, "label": null, "multi": false, "multiFormat": "glob", "name": "cluster", "options": [], "query": "label_values(jvm_memory_pool_bytes_used{namespace=\"$namespace\"}, cassandra_cluster)", "refresh": 1, "refresh_on_load": false, "regex": "", "skipUrlSync": false, "sort": 0, "tagValuesQuery": null, "tags": [], "tagsQuery": null, "type": "query", "useTags": false }, { "allFormat": "glob", "allValue": ".*", "current": { "isNone": true, "tags": [], "text": "", "value": [] }, "datasource": "$prometheus", "definition": "", "hide": 0, "includeAll": false, "label": null, "multi": true, "multiFormat": "glob", "name": "keyspace", "options": [], "query": "label_values(cassandra_table_livediskspaceused{cassandra_cluster=\"$cluster\",namespace=\"$namespace\"},keyspace)", "refresh": 1, "refresh_on_load": false, "regex": "", "skipUrlSync": false, "sort": 0, "tagValuesQuery": null, "tags": [], "tagsQuery": null, "type": "query", "useTags": false }, { "allFormat": "regex wildcard", "allValue": ".*", "current": { "text": "All", "value": "$__all" }, "datasource": "$prometheus", "definition": "", "hide": 0, "includeAll": true, "label": null, "multi": false, "multiFormat": "glob", "name": "table", "options": [], "query": "label_values(cassandra_table_livediskspaceused{cassandra_cluster=\"$cluster\", namespace=\"$namespace\", keyspace=\"$keyspace\"}, table)", "refresh": 1, "refresh_on_load": false, "regex": "", "skipUrlSync": false, "sort": 0, "tagValuesQuery": null, "tags": [], "tagsQuery": null, "type": "query", "useTags": false }, { "allFormat": "regex wildcard", "allValue": ".*", "current": { "text": "All", "value": [ "$__all" ] }, "datasource": "$prometheus", "definition": "", "hide": 0, "includeAll": true, "label": null, "multi": true, "multiFormat": "glob", "name": "pod", "options": [], "query": "label_values(cassandra_table_livediskspaceused{cassandra_cluster=\"$cluster\", namespace=\"$namespace\"}, pod)", "refresh": 1, "refresh_on_load": false, "regex": "", "skipUrlSync": false, "sort": 0, "tagValuesQuery": null, "tags": [], "tagsQuery": null, "type": "query", "useTags": false } ] }, "time": { "from": "now-1h", "to": "now" }, "timepicker": { "now": true, "refresh_intervals": [ "5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d" ], "time_options": [ "5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d" ] }, "timezone": "browser", "title": "Cassandra Keyspace Stats - Operator Clusters", "uid": "4pX9bkbmk", "version": 1 }
  Cassandra-Memory-And-GC.json: |
    { "annotations": { "list": [ { "builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard" } ] }, "editable": true, "gnetId": null, "graphTooltip": 0, "iteration": 1562773955603, "links": [], "panels": [ { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "fill": 1, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 0 }, "id": 21, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "sum by (pod) (jvm_gc_collection_seconds_sum{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\"})  - sum by (pod) (jvm_gc_collection_seconds_sum{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\"} offset 30s)", "format": "time_series", "interval": "30s", "intervalFactor": 1, "legendFormat": "{{ pod }}", "metric": "", "refId": "A", "step": 30 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "GCs [30s]", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "label": "Time Spent (s)", "logBase": 1, "max": null, "min": "0", "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "fill": 1, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 7 }, "id": 27, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "jvm_gc_collection_seconds_sum{gc=\"ParNew\", namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\"} - jvm_gc_collection_seconds_sum{gc=\"ParNew\", namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\"} offset 30s", "format": "time_series", "interval": "30s", "intervalFactor": 1, "legendFormat": "{{ pod }}", "refId": "A", "step": 30 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "GC ParNew[30s]", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "label": null, "logBase": 1, "max": null, "min": "0", "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "description": "Includes only STW pauses in CMS", "fill": 1, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 14 }, "id": 28, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "jvm_gc_collection_seconds_sum{gc=\"ConcurrentMarkSweep\", namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\"} - jvm_gc_collection_seconds_sum{gc=\"ConcurrentMarkSweep\", namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\"} offset 30s", "format": "time_series", "interval": "30s", "intervalFactor": 1, "legendFormat": "{{ pod }}", "refId": "A", "step": 30 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "GC CMS[30s]", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "label": null, "logBase": 1, "max": null, "min": "0", "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": true, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "fill": 1, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 21 }, "id": 26, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": false, "linewidth": 1, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "(sum(jvm_gc_collection_seconds_sum{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\"}) by (cassandra_cluster, pod) - sum(jvm_gc_collection_seconds_sum{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\"} offset 30s) by (cassandra_cluster, pod)) / (sum(jvm_gc_collection_seconds_count{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\"}) by (cassandra_cluster, pod) - sum(jvm_gc_collection_seconds_count{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\"} offset 30s) by (cassandra_cluster, pod))", "format": "time_series", "interval": "30s", "intervalFactor": 1, "legendFormat": "{{ pod }}", "refId": "A", "step": 30 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Average GC time [30s]", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "s", "label": null, "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "description": "How much of the filesystem (cassandra data files) are cached in memory.", "fill": 1, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 28 }, "id": 23, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "container_memory_cache{namespace=\"$namespace\", pod_name=~\"$pod\", container_name=\"cassandra\"}", "format": "time_series", "interval": "30s", "intervalFactor": 1, "legendFormat": "{{ pod_name }}", "metric": "", "refId": "A", "step": 30 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Memory Filesystem Cache", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "decbytes", "label": "", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "description": "How much memory is completely free. If this is low, it indicates not enough space for filesystem cache.", "fill": 1, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 35 }, "id": 24, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "container_spec_memory_limit_bytes{namespace=\"$namespace\", pod_name=~\"$pod\", container_name=\"cassandra\"} - container_memory_usage_bytes{namespace=\"$namespace\", pod_name=~\"$pod\", container_name=\"cassandra\"}", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{ pod_name }}", "refId": "A", "step": 10 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Memory Free", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "decbytes", "label": null, "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "editable": true, "error": false, "fill": 1, "grid": {}, "gridPos": { "h": 8, "w": 24, "x": 0, "y": 42 }, "id": 18, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 2, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "jvm_memory_pool_bytes_used{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\", pool=~\".*Eden Space\"}", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{pod}} Eden", "refId": "A", "step": 10 }, { "expr": "jvm_memory_pool_bytes_used{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\",pool=~\".*Survivor Space\"}", "format": "time_series", "hide": false, "intervalFactor": 2, "legendFormat": "{{pod}} Survivor", "refId": "B", "step": 10 }, { "expr": "jvm_memory_pool_bytes_used{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\",pool=~\".*Old Gen\"}", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{pod}} Old", "refId": "D", "step": 10 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "JVM Heap", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "cumulative" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "logBase": 1, "max": null, "min": null, "show": true }, { "format": "bytes", "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "fill": 1, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 50 }, "id": 19, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "jvm_memory_pool_bytes_used{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\",pool=\"Metaspace\"}", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{ pod }} Metaspace", "refId": "A", "step": 10 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Metaspace", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } }, { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "datasource": "$prometheus", "fill": 1, "gridPos": { "h": 7, "w": 24, "x": 0, "y": 57 }, "id": 20, "legend": { "avg": false, "current": false, "max": false, "min": false, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "connected", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "jvm_memory_pool_bytes_used{namespace=\"$namespace\", pod=~\"$pod\", cassandra_cluster=\"$cluster\",pool=\"Code Cache\"}", "format": "time_series", "intervalFactor": 2, "legendFormat": "{{ pod }} ", "refId": "A", "step": 10 } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Code Cache", "tooltip": { "msResolution": false, "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } } ], "refresh": false, "schemaVersion": 16, "style": "dark", "tags": [], "templating": { "list": [ { "current": { "tags": [], "text": "Prometheus", "value": "Prometheus" }, "hide": 0, "label": null, "name": "prometheus", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "skipUrlSync": false, "type": "datasource" }, { "allValue": null, "current": { "tags": [], "text": "test-cassandra-operator", "value": "test-cassandra-operator" }, "datasource": "$prometheus", "definition": "", "hide": 0, "includeAll": false, "label": null, "multi": false, "name": "namespace", "options": [ { "selected": true, "text": "test-cassandra-operator", "value": "test-cassandra-operator" } ], "query": "label_values(jvm_gc_collection_seconds_sum{cassandra_cluster=~\".+\"}, namespace)", "refresh": 0, "regex": "", "skipUrlSync": false, "sort": 1, "tagValuesQuery": "", "tags": [], "tagsQuery": "", "type": "query", "useTags": false }, { "allFormat": "glob", "allValue": null, "current": { "tags": [], "text": "small-cluster", "value": "small-cluster" }, "datasource": "$prometheus", "definition": "", "hide": 0, "includeAll": false, "label": null, "multi": false, "multiFormat": "glob", "name": "cluster", "options": [], "query": "label_values(jvm_gc_collection_seconds_sum{namespace=\"$namespace\"}, cassandra_cluster)", "refresh": 1, "refresh_on_load": false, "regex": "", "skipUrlSync": false, "sort": 1, "tagValuesQuery": null, "tags": [], "tagsQuery": null, "type": "query", "useTags": false }, { "allFormat": "regex wildcard", "allValue": ".*", "current": { "text": "All", "value": "$__all" }, "datasource": "$prometheus", "definition": "", "hide": 0, "hideLabel": false, "includeAll": true, "label": null, "multi": false, "multiFormat": "regex values", "name": "pod", "options": [], "query": "label_values(jvm_gc_collection_seconds_sum{namespace=\"$namespace\", cassandra_cluster=\"$cluster\"}, pod)", "refresh": 1, "refresh_on_load": false, "regex": "", "skipUrlSync": false, "sort": 0, "tagValuesQuery": null, "tags": [], "tagsQuery": null, "type": "query", "useTags": false } ] }, "time": { "from": "now-30m", "to": "now" }, "timepicker": { "now": true, "refresh_intervals": [ "5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d" ], "time_options": [ "5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d" ] }, "timezone": "browser", "title": "Cassandra Memory & GC - Operator Clusters", "uid": "en0joWbmz", "version": 1 }

